<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 程式版本 = V1.000 -->
<mapper namespace="docrm.dao.DOCRM220M_">
	
	<select id="queryDOCRMT200" parameterType="HashMap" resultType="HashMap">
		SELECT DOCRMT200.PKNO,
			   DOCRMT200.MESS_NO,
			   DOCRMT200.DOCRM_NO,
			   DOCRMT200.TAX_TP,
			   DOCRMT200.DOCRM_TP,
			   DOCRMT200.ACP_CD,
			   DOCRMT200.RDC_NO,
			   DOCRMT200.VERIFY_NO,
			   DOCRMT200.APPLY_NM,
			   DOCRMT200.APPLY_IDN,
			   DOCRMT200.APPLY_SUBJECT,
			   DOCRMT200.APPLY_DATE,
			   DOCRMT200.LMT_DATE,
			   DOCRMT200.CPL_DATE,
			   DOCRMT200.MOBILE_NO,
			   DOCRMT200.EMAIL,
			   DOCRMT200.DOCRM_STUS,
			   DOCRMT200.MSG_STUS,
			   DOCRMT200.ADD_MK,
			   DOCRMT200.ADD_STUS,
			   DOCRMT200.DOC_ORG_ID,
			   DOCRMT200.DOC_STF_NM,
			   DOCRMT200.CREATE_DATE,
			   DOCRMT200.CREATE_TIME,
			   DOCRMT200.CREATE_USER_ID,
			   DOCRMT200.UPDATE_DATE,
			   DOCRMT200.UPDATE_TIME,
			   DOCRMT200.UPDATE_USER_ID,
			   R1.PHRASE_TITLE AS TAX_TP_NM,
			   R2.PHRASE_TITLE AS DOCRM_STUS_NM,
			   R3.PHRASE_TITLE AS ACP_CD_NM,
			   R4.PHRASE_TITLE AS DOC_ORG_ID_NM,
			   R5.DOCRM_TP_NM,
			   R6.PHRASE_TITLE AS ADD_MK_NM,
			   R7.PHRASE_TITLE AS ADD_STUS_NM
		  FROM DOCRMT200 
		  LEFT JOIN DOCRMT850 R1 ON R1.PHRASE_KEY = DOCRMT200.TAX_TP AND R1.PHRASE_TYPE_KEY = 'TAX_TP'
		  LEFT JOIN DOCRMT850 R2 ON R2.PHRASE_KEY = DOCRMT200.DOCRM_STUS AND R2.PHRASE_TYPE_KEY = 'DOCRM_STUS'
		  LEFT JOIN DOCRMT850 R3 ON R3.PHRASE_KEY = DOCRMT200.ACP_CD AND R3.PHRASE_TYPE_KEY = 'ORG_ID'
		  LEFT JOIN DOCRMT850 R4 ON R4.PHRASE_KEY = DOCRMT200.DOC_ORG_ID AND R4.PHRASE_TYPE_KEY = 'ORG_ID'
		  LEFT JOIN DOCRMT820 R5 ON R5.TAX_TP = DOCRMT200.TAX_TP AND R5.DOCRM_TP = DOCRMT200.DOCRM_TP
		  LEFT JOIN DOCRMT850 R6 ON R6.PHRASE_KEY = DOCRMT200.ADD_MK AND R6.PHRASE_TYPE_KEY = 'YN_MK'
		  LEFT JOIN DOCRMT850 R7 ON R7.PHRASE_KEY = DOCRMT200.ADD_STUS AND R7.PHRASE_TYPE_KEY = 'ADD_STUS'
		 WHERE DOCRM_STUS <![CDATA[<>]]> '0'
		  		<if test="PKNO != null and PKNO != '' ">AND DOCRMT200.PKNO = #{PKNO}</if>
		  		<if test="MESS_NO != null and MESS_NO != '' ">AND DOCRMT200.MESS_NO = #{MESS_NO}</if>
		  		<if test="TAX_TP != null and TAX_TP != '' ">AND DOCRMT200.TAX_TP = #{TAX_TP}</if>
		  		<if test="DOCRM_TP != null and DOCRM_TP != '' ">AND DOCRMT200.DOCRM_TP = #{DOCRM_TP}</if>
		  		<if test="APPLY_NM != null and APPLY_NM != '' ">AND DOCRMT200.APPLY_NM = #{APPLY_NM}</if>
		  		<if test="APPLY_IDN != null and APPLY_IDN != '' ">AND DOCRMT200.APPLY_IDN = #{APPLY_IDN}</if>
		  		<if test="DOCRM_NO != null and DOCRM_NO != '' ">AND DOCRMT200.DOCRM_NO = #{DOCRM_NO}</if>
		  		<if test="DOCRM_STUS != null and DOCRM_STUS != '' ">AND DOCRMT200.DOCRM_STUS = #{DOCRM_STUS}</if>
		  		<if test="START_APPLY_DATE != null and START_APPLY_DATE != '' ">AND DOCRMT200.APPLY_DATE <![CDATA[> =]]> #{START_APPLY_DATE}</if>
		  		<if test="END_APPLY_DATE != null and END_APPLY_DATE != '' ">AND DOCRMT200.APPLY_DATE <![CDATA[< =]]> #{END_APPLY_DATE}</if>

	</select>

	<select id="queryDOCRMT300" parameterType="HashMap" resultType="HashMap">
		SELECT DOCRMT300.PKNO,
		       DOCRMT300.SD_DATE,
		       DOCRMT300.SD_TIME,
		       CONCAT(CONCAT(DOCRMT300.SD_DATE,' '), DOCRMT300.SD_TIME) AS SD_DATE_TIME,
		       R1.PHRASE_TITLE AS DOCRM_STUS_NM,
		       R2.PHRASE_TITLE AS TRN_ORG_ID_NM
		  FROM DOCRMT300
		  LEFT JOIN DOCRMT850 R1 ON R1.PHRASE_KEY = DOCRMT300.DOCRM_STUS AND R1.PHRASE_TYPE_KEY = 'DOCRM_STUS'
		  LEFT JOIN DOCRMT850 R2 ON R2.PHRASE_KEY = DOCRMT300.TRN_ORG_ID AND R2.PHRASE_TYPE_KEY = 'ORG_ID'
		 WHERE DOCRMT300.DOCRM_STUS IS NOT NULL
		  		<if test="MESS_NO != null and MESS_NO != '' ">AND DOCRMT300.MESS_NO = #{MESS_NO}</if>
		 ORDER BY R1.SORT_NO 
	</select>
	
	<select id="queryDOCRMT300MSG" parameterType="HashMap" resultType="HashMap">
		SELECT DOCRMT300.PKNO,
			   DOCRMT300.SD_DATE,
		       DOCRMT300.SD_TIME,
		       CONCAT(CONCAT(DOCRMT300.SD_DATE,' '), DOCRMT300.SD_TIME) AS SD_DATE_TIME,
		       R1.PHRASE_TITLE AS MSG_STUS_NM
		  FROM DOCRMT300
		  LEFT JOIN DOCRMT850 R1 ON R1.PHRASE_KEY = DOCRMT300.MSG_STUS AND R1.PHRASE_TYPE_KEY = 'MSG_STUS'
		 WHERE DOCRMT300.MSG_STUS IS NOT NULL
		  		<if test="MESS_NO != null and MESS_NO != '' ">AND DOCRMT300.MESS_NO = #{MESS_NO}</if>
		 ORDER BY R1.SORT_NO 
	</select>
	
	<select id="queryDOCRMT210" parameterType="HashMap" resultType="HashMap">
		SELECT DOCRMT210.PKNO,
		       DOCRMT200.DOCRM_NO,
		       DOCRMT210.MESS_NO,
		       DOCRMT210.FILE_NO,
		       SUBSTR(DOCRMT210.FILE_NM,15)  AS FILE_NM,
		       DOCRMT210.SD_DATE,
		       DOCRMT210.SD_TIME,
		       CONCAT(CONCAT(DOCRMT210.SD_DATE,' '), DOCRMT210.SD_TIME) AS SD_DATE_TIME,
		       R1.PHRASE_TITLE AS FILE_STUS_NM,
		       (CASE WHEN R2.PHRASE_TITLE IS NULL THEN "民眾自行上傳" ELSE R2.PHRASE_TITLE END) AS SOURCE_NM
		  FROM DOCRMT210
		  LEFT JOIN DOCRMT200 ON DOCRMT200.MESS_NO = DOCRMT210.MESS_NO
		  LEFT JOIN DOCRMT850 R1 ON R1.PHRASE_KEY = DOCRMT210.FILE_STUS AND R1.PHRASE_TYPE_KEY = 'FILE_STUS'
		  LEFT JOIN DOCRMT850 R2 ON R2.PHRASE_KEY = DOCRMT210.SOURCE AND R2.PHRASE_TYPE_KEY = 'ORG_ID'
		 <where>
		 		<if test="MESS_NO != null and MESS_NO != '' ">AND DOCRMT210.MESS_NO = #{MESS_NO}</if>
		 </where>	
	</select>
	
	<select id="queryDOCRMT310" parameterType="HashMap" resultType="HashMap">
		SELECT DOCRMT310.PKNO,
		       DOCRMT310.FILE_NO,
		       DOCRMT310.FILE_STUS,
		       DOCRMT310.SD_DATE,
		       DOCRMT310.SD_TIME,
		       CONCAT(CONCAT(DOCRMT310.SD_DATE,' '), DOCRMT310.SD_TIME) AS SD_DATE_TIME,
		       R1.PHRASE_TITLE AS FILE_STUS_NM
		  FROM DOCRMT310
		  LEFT JOIN DOCRMT850 R1 ON R1.PHRASE_KEY = DOCRMT310.FILE_STUS AND R1.PHRASE_TYPE_KEY = 'FILE_STUS'
		<where>
		  		<if test="FILE_NO != null and FILE_NO != '' ">AND DOCRMT310.FILE_NO = #{FILE_NO}</if>
		</where>
	</select>
	
</mapper>
